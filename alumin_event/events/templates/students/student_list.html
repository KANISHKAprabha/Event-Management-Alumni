{% extends 'base.html' %}
{% block title %}Students{% endblock %}
{% block content %}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>Students</h1>
        <a href="{% url 'student_add' %}" class="btn btn-success">Add Student</a>
    </div>

    <form method="GET" action="{% url 'student_list' %}" class="mb-4">
        <div class="input-group">
            <input type="text" class="form-control" name="q" placeholder="Search by first or last name..." value="{{ search_query }}">
            <button class="btn btn-primary" type="submit">Search</button>
        </div>
    </form>

    <div class="table-responsive">
        <table class="table table-bordered table-striped table-sm">
            <thead class="table-dark">
                <tr>
                    <th>University Reg. No</th>
                    <th>Roll No</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Full Name</th>
                    <th>Gender</th>
                    <th>DOB</th>
                    <th>Mobile</th>
                    <th>State</th>
                    <th>Email</th>

                    <th>Father Name</th>
                    <th>Father Mobile</th>
                    <th>Father Occupation</th>
                    <th>Father Organization</th>

                    <th>Mother Name</th>
                    <th>Mother Mobile</th>
                    <th>Mother Occupation</th>
                    <th>Mother Organization</th>

                    <th>Batch</th>
                    <th>Department</th>
                    <th>Current Location</th>
                    <th>Current Company</th>
                    <th>Designation</th>
                    <th>Position</th>
                    <th>Job Domain</th>

                    <th>Phone 1</th>
                    <th>Phone 2</th>
                    <th>Personal Email</th>
                    <th>Official Email</th>
                    <th>LinkedIn</th>

                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for student in students %}
                <tr>
                    <td>{{ student.university_register_number }}</td>
                    <td>{{ student.roll_no }}</td>
                    <td>{{ student.f_name }}</td>
                    <td>{{ student.lname }}</td>
                    <td>{{ student.student_name }}</td>
                    <td>{{ student.gender }}</td>
                    <td>{{ student.date_of_birth }}</td>
                    <td>{{ student.mobile_number }}</td>
                    <td>{{ student.state }}</td>
                    <td>{{ student.email_id }}</td>

                    <td>{{ student.father_name }}</td>
                    <td>{{ student.father_mobile_number }}</td>
                    <td>{{ student.father_occupation }}</td>
                    <td>{{ student.father_organization }}</td>

                    <td>{{ student.mother_name }}</td>
                    <td>{{ student.mother_mobile_number }}</td>
                    <td>{{ student.mother_occupation }}</td>
                    <td>{{ student.mother_organization }}</td>

                    <td>{{ student.batch }}</td>
                    <td>{{ student.department }}</td>
                    <td>{{ student.current_location }}</td>
                    <td>{{ student.current_company }}</td>
                    <td>{{ student.designation }}</td>
                    <td>{{ student.position }}</td>
                    <td>{{ student.job_domain }}</td>

                    <td>{{ student.phone_number }}</td>
                    <td>{{ student.phone_number2 }}</td>
                    <td>{{ student.personal_email_id }}</td>
                    <td>{{ student.official_email_id }}</td>
                    <td><a href="{{ student.linkedin_link }}" target="_blank">Profile</a></td>

                    <td>
                        <a href="{% url 'student_edit' student.pk %}" class="btn btn-primary btn-sm mb-2">Edit</a>
                        <a href="{% url 'student_delete' student.pk %}" class="btn btn-danger btn-sm">Delete</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="32" class="text-center">
                        {% if search_query %}
                            No students found matching your search for "{{ search_query }}".
                        {% else %}
                            No students found.
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if is_paginated %}
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?q={{ search_query }}&page={{ page_obj.previous_page_number }}">&laquo;</a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
            {% endif %}

            {% for page_num in paginator.page_range %}
                {% if page_obj.number == page_num %}
                    <li class="page-item active" aria-current="page"><span class="page-link">{{ page_num }}</span></li>
                {% elif page_num > page_obj.number|add:'-3' and page_num < page_obj.number|add:'3' %}
                    <li class="page-item"><a class="page-link" href="?q={{ search_query }}&page={{ page_num }}">{{ page_num }}</a></li>
                {% elif page_num == 1 %}
                    <li class="page-item"><a class="page-link" href="?q={{ search_query }}&page=1">1</a></li>
                    {% if page_obj.number > 3 %}
                        <li class="page-item disabled"><span class="page-link">...</span></li>
                    {% endif %}
                {% elif page_num == paginator.num_pages %}
                    {% if page_obj.number < paginator.num_pages|add:'-2' %}
                        <li class="page-item disabled"><span class="page-link">...</span></li>
                    {% endif %}
                    <li class="page-item"><a class="page-link" href="?q={{ search_query }}&page={{ page_num }}">{{ page_num }}</a></li>
                {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?q={{ search_query }}&page={{ page_obj.next_page_number }}">&raquo;</a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}
</div>

{% url 'student_list' as list_url %}
<button type="button" class="btn btn-primary w-100 mb-2" onclick="window.location.href='{{ list_url }}'">
    Back
</button>

{% url 'event_list' as list_url_events %}
<button type="button" class="btn btn-primary w-100" onclick="window.location.href='{{ list_url_events }}'">
    Back To Events List
</button>

{% endblock %}
