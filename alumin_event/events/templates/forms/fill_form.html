{% extends 'base.html' %}
{% load static %}

{% block title %}Fill Form - {{ form_def.name }}{% endblock %}

{% block content %}
<div class="container mt-5 d-flex justify-content-center">
    <div class="card shadow p-4 rounded-3" style="max-width: 750px; width: 100%;">
        
        <!-- Form Title -->
        <h2 class="mb-3 text-center fw-bold">{{ form_def.name }}</h2>
        <p class="text-muted  mb-4">{{ form_def.description|safe }}</p>

        <!-- Dynamic Form -->
         {% if remaining_submissions > 0 %}
        <form id="dynamic-form" method="post" enctype="multipart/form-data" class="row g-3">
            {% csrf_token %}

            {% for field in form %}
            <div class="col-12">
                <label for="{{ field.id_for_label }}" class="form-label fw-semibold">
                    {{ field.label }}
                </label>
                {{ field }}
                
                {% if field.help_text %}
                    <small class="form-text text-muted">{{ field.help_text }}</small>
                {% endif %}
                {% for error in field.errors %}
                    <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
            {% endfor %}

            <!-- Buttons -->
            <div class="col-12 d-flex gap-2 mt-3">
                <button type="submit" id="submit-btn" class="btn btn-primary w-100 shadow-sm">
                    Submit
                </button>
                
                <a href="{% url 'register_event' %}" class="btn btn-outline-secondary w-100 shadow-sm">
                    Cancel
                </a>
            </div>
        </form>
        {% else %}
<div class="alert alert-warning text-center">
    You have reached the maximum number of submissions for this form.
</div>
{% endif %}
    </div>
</div>

<!-- Styling for textarea (fixed editor look) -->
<style>
    textarea.form-control {
        min-height: 180px;
        font-family: monospace;
        background-color: #f9fafb;
        resize: none; /* lock resizing */
        box-shadow: inset 0 1px 2px rgba(0,0,0,.1);
    }
</style>

<!-- Prevent multiple submissions -->
<script>
    document.getElementById("dynamic-form").addEventListener("submit", function() {
        let btn = document.getElementById("submit-btn");
        btn.disabled = true;
        btn.innerText = "Submitting...";
    });
</script>
{% endblock %}
